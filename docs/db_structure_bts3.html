<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="Docutils 0.13.1: http://docutils.sourceforge.net/" />
<title>Datenbankstruktur des BTS Version 3</title>
<link rel="stylesheet" href="bootstrap.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="datenbankstruktur-des-bts-version-3">
<h1 class="title">Datenbankstruktur des BTS Version 3</h1>

<div class="section" id="einleitung">
<h1>Einleitung</h1>
<p>Das BTS3 läuft auf einer CouchDB. Es gibt eine zentrale Instanz sowie als Teil jeder BTS3-Installation eine lokale
Instanz. Die lokale Instanz wird über die CouchDB-eigene Synchronisationsfunktion bidirektional mit der zentralen
Instanz synchronisiert. Lokal redet der BTS3-Java-Prozess über HTTP an localhost mit der lokalen CouchDB. Im
BTS3-Java-prozess läuft eingebettet eine Elasticsearch-Instanz, die mit Daten aus der lokalen CouchDB gefüttert wird.
Deshalb ist die auch ständig nicht mehr synchron und muss ständig von Hand über den BTS3-Datenbankmanager neu
synchronisiert werden.</p>
<p>This document starts out with an overview of all object types defined in the source, not their manifestation in the
database. Thus it includes super-types that are not directly present in the database.</p>
</div>
<div class="section" id="allgemeines-objektlayout-in-der-datenbank">
<h1>Allgemeines Objektlayout in der Datenbank</h1>
<p>Alle hier aufgelisteten Objekte bilden 1:1 auf Java-Klassen ab. All diese Klassen sind Teil des Eclipse eObject-Systems.
Jedes Objekt enthält ein Attribut <span class="docutils literal">eClass</span>, das eine Pseudo-URL enthält, die den Typen dieses Objektes eindeutig
identifiziert. Diese URL folgt immer dem Schema <span class="docutils literal"><span class="pre">http://{&quot;btsmodel&quot;</span> oder <span class="pre">&quot;btsCorpusModel&quot;}/1.0#//{Name</span> der eClass}</span>.
Es gibt zwei Gruppen von eClass-Definitionen, oder <em>Modelle</em>: Das <span class="docutils literal">btsmodel</span> sowie das <span class="docutils literal">btsCorpusModel</span> (sic!).
Ersteres enthält hauptsächlich interne Verwaltungsklassen, letzteres die Klassen für die eigentlichen Nutzdaten. Im
folgenden eine Auflistung aller definierten <span class="docutils literal">eClass</span>-Pseudo-URLs mit der Angabe, ob diese auch tatsächlich irgendwo in
der Datenbank zu finden sind.</p>
<div class="figure">
<a class="reference external image-reference" href="graphs/basemodel_interface_graph.pdf"><img alt="graphs/basemodel_interface_graph.png" src="graphs/basemodel_interface_graph.png" style="width: 100%;" /></a>
<p class="caption">Graph of all interfaces of the base model. For one including the impls, see <a class="reference external" href="graphs/basemodel_type_graph.pdf">basemodel_type_graph.pdf</a>.</p>
</div>
<div class="figure">
<a class="reference external image-reference" href="graphs/corpusmodel_interface_graph.pdf"><img alt="graphs/corpusmodel_interface_graph.png" src="graphs/corpusmodel_interface_graph.png" style="width: 100%;" /></a>
<p class="caption">Graph of all interfaces of the corpus model. For one including the impls, see <a class="reference external" href="graphs/corpusmodel_type_graph.pdf">corpusmodel_type_graph.pdf</a>.</p>
</div>
<div class="section" id="definierte-eclasses-des-basis-modells">
<h2>Definierte eClasses des Basis-Modells</h2>
<table>
<colgroup>
<col style="width: 63%" />
<col style="width: 22%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr><th class="head"><p>eClass</p></th>
<th class="head"><p>In Datenbank <a class="footnote-reference brackets" href="#db" id="id1">1</a></p></th>
<th class="head"><p>Anmerkungen</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//AdministrativDataObject</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSComment</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSConfig</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSConfigItem</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSConfiguration</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSDBBaseObject</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSDBCollectionRoleDesc</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSDBConnection</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSDate</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSExternalReference</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSIDReservationObject</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSIdentifiableItem</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSInterTextReference</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSNamedTypedObject</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSObject</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSObservableObject</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSOperator</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSPassportEditorConfig</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSProject</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSProjectDBCollection</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSReferencableItem</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSRelation</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSRevision</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSTimespan</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSTranslation</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSTranslations</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSUser</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSUserGroup</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSWorkflowRule</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//BTSWorkflowRuleItem</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//DBLease</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//UserActionCounter</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//StringToStringListMap</span></span></p></td>
<td><p>✘</p></td>
<td><p><a class="footnote-reference brackets" href="#implonly" id="id2">2</a></p></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsmodel/1.0#//StringToStringMap</span></span></p></td>
<td><p>✘</p></td>
<td><p><a class="footnote-reference brackets" href="#implonly" id="id3">2</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="definierte-eclasses-des-corpus-modells">
<h2>Definierte eClasses des Corpus-Modells</h2>
<table>
<colgroup>
<col style="width: 63%" />
<col style="width: 22%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr><th class="head"><p>eClass</p></th>
<th class="head"><p>In Datenbank <a class="footnote-reference brackets" href="#db" id="id4">1</a></p></th>
<th class="head"><p>Anmerkungen</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSAbstractParagraph</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSAbstractText</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSAmbivalence</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSAmbivalenceItem</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSAnnotation</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSCorpusHeader</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSCorpusObject</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSGraphic</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSImage</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSLemmaCase</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSLemmaEntry</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSMarker</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSPassport</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSPassportEntry</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSPassportEntryGroup</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSPassportEntryItem</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSSenctence</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSSentenceItem</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSTCObject</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSText</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSTextContent</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSTextCorpus</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSTextItems</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSTextSentenceItem</span></span></p></td>
<td><p>✘</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSThsEntry</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">http://btsCorpusModel/1.0#//BTSWord</span></span></p></td>
<td><p>✔</p></td>
<td></td>
</tr>
</tbody>
</table>
<dl class="footnote brackets">
<dt class="label" id="db"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p>Ist die jeweilige eClass zwar im Modell vorhanden, aber nirgendwo in der Datenbank zu finden? Das ist z.B. bei
rein abstrakten Basisklassen der Fall.</p>
</dd>
<dt class="label" id="implonly"><span class="brackets">2</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id3">2</a>)</span></dt>
<dd><p>Es ist kein separates Interface vorhanden. Die zugehörige Impl-Klasse benutzt ein generisches
Eclipse-Interface.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="objekttypen-des-basis-modells">
<h1>Objekttypen des Basis-Modells</h1>
<div class="section" id="administrativdataobject">
<h2>AdministrativDataObject</h2>
<p>AdministrativDataObject is a base class of BTSObject meant to bring in object versioning functionality. Its fields are
the following.</p>
<dl class="field-list">
<dt><span class="docutils literal">revisions</span></dt>
<dd><p>A list of revisions of this object. In the database json, this is mapped to an array of strings. This usually looks
like this:</p>
<pre class="code literal-block"><code>[ &quot;0&#64;2015-06-26T16:13:16&#64;74cb6b70ab6b58566bfadc664b00282d&quot;,
  &quot;1&#64;2015-06-26T16:18:09&#64;74cb6b70ab6b58566bfadc664b00282d&quot;,
  &quot;2&#64;2015-08-06T10:56:12&#64;IHYWLODR3RDGHIAJRRNREH7MIQ&quot; ]</code></pre>
<p>The first element is an incrementing revision number, the second one is a timestamp in some random timezone and the
third one is the couchdb object id of the user to blame. As usual, don't expect these to <em>always</em> actually follow
that format as <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/db/model/src/org/bbaw/bts/btsmodel/impl/BtsmodelFactoryImpl.java#L491">the parsing code in BtsmodelFactoryImpl.java</a> made to fail silently.</p>
</dd>
</dl>
<dl class="field-list">
<dt><span class="docutils literal">state</span></dt>
<dd><p>This field is part of an improvised tombstone implementation. It may assume the values <span class="docutils literal">active</span> or <span class="docutils literal">terminated</span>.
Absence of this field seems to be considered equivalent with its value being <span class="docutils literal">active</span>.</p>
<p>The semantics of this are similar to a &quot;is_deleted&quot; field. To &quot;delete&quot; an object, you set its <span class="docutils literal">state</span> from
<span class="docutils literal">active</span> to <span class="docutils literal">terminated</span>, but leave the object in the database. This means you never delete an object's history
and an user can't mess up <em>too</em> bad.</p>
<p>This field seems to be only ever checked in a smattering of UI classes, namely <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/ui/corpus/src/org/bbaw/bts/ui/corpus/parts/CorpusNavigatorPart.java#L434">CorpusNavigatorPart.java</a>, <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/ui/corpus/src/org/bbaw/bts/ui/corpus/parts/AnnotationsPart.java#L809">AnnotationsPart.java</a>, <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/ui/egy/src/org/bbaw/bts/ui/egy/textSign/SignTextComposite.java#L1776">SignTextComposite.java</a> and <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/ui/egy/src/org/bbaw/bts/ui/egy/parts/EgyTextEditorPart.java#L2135">EgyTextEditorPart.java</a>.</p>
</dd>
</dl>
<dl class="field-list">
<dt><span class="docutils literal">revisionState</span></dt>
<dd><p>This field is also called <span class="docutils literal">reviewState</span>, it is an enum string.  The possible values of this field are enumerated
under the <span class="docutils literal"><span class="pre">Revision-Status</span></span> meta model entry.  There is a convoluted system in place to restrict which states can
be applied to which object types, however in practice luckily this remains mostly unused.</p>
<p>The meaning of this field is something along the lines of &quot;has this object been reviewed for publication?&quot;</p>
<p>This field is used in the code in a somewhat inconsistent manner. Most object types do not have any code referring
to it even though all objects carry it. It seems the only place it <em>is</em> in fact used is with lemmata, and there <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/core/corpus-services-impl/src/org/bbaw/bts/core/services/corpus/impl/services/BTSLemmaEntryServiceImpl.java#L244">the
code</a> looks like this:</p>
<pre class="code literal-block"><code>entry.getRevisionState().contains(&quot;obsolete&quot;)</code></pre>
</dd>
</dl>
<dl class="field-list">
<dt><span class="docutils literal">visibility</span></dt>
<dd><p>This field is supposed to provide basic read/list access control on objects. Its possible values seem to be supposed
to be described in the <span class="docutils literal">Visibility</span> meta model entry, which contains <span class="docutils literal">group</span>, <span class="docutils literal">project</span>, <span class="docutils literal">public</span>,
<span class="docutils literal">Reader</span> and <span class="docutils literal">all_authenticated</span>. The code however contains at least one reference to one additional value
<span class="docutils literal">repository</span> in one of the obfuscated embedded design documents in <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/db/couch/src/org/bbaw/bts/db/couchdb/impl/CouchDBManager.java#L98">CouchDBManager.java</a>.</p>
<p>The code can't quite decide whether to check this at the database level (see the above reference) or <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/core/corpus-controller-impl/src/org/bbaw/bts/core/corpus/controller/impl/partController/CorpusNavigatorControllerImpl.java#L373">in the client</a>.</p>
</dd>
</dl>
</div>
<div class="section" id="btscomment">
<h2>BTSComment</h2>
<p>A <span class="docutils literal">BTSComment</span> describes a human-language comment on some object or text section. All comments on a project are stored in
the project's <span class="docutils literal">{project name}_admin</span> database and link to their target object or text part by means of exactly one
<span class="docutils literal">partOf</span> relation. For details, see <a class="reference internal" href="#partof-relations">PartOf relations</a>.</p>
<p>A <span class="docutils literal">BTSComment</span> is a <a class="reference internal" href="#btsobject">BTSObject</a> and has the following fields:</p>
<dl class="field-list simple">
<dt><span class="docutils literal">comment</span></dt>
<dd><p>The comment's human-readable plain text</p>
</dd>
<dt><span class="docutils literal">tags</span></dt>
<dd><p>Unused.</p>
</dd>
</dl>
</div>
<div class="section" id="btsconfig">
<h2>BTSConfig</h2>
<p><span class="docutils literal">BTSConfig</span> is a super-type of <a class="reference internal" href="#btsconfigitem">BTSConfigItem</a> and <a class="reference internal" href="#btsconfiguration">BTSConfiguration</a> that provides their <span class="docutils literal">children</span> attributes.</p>
<dl class="field-list simple">
<dt><span class="docutils literal">children</span></dt>
<dd><p>The logical children of this <a class="reference internal" href="#btsconfiguration">BTSConfiguration</a> or <a class="reference internal" href="#btsconfigitem">BTSConfigItem</a>. On the top levels of a <a class="reference internal" href="#btsconfiguration">BTSConfiguration</a>
this is used to categorize according to function of the config subtree. In the passport configuration this hierarchy
is used to describe the hierarchy of passport fields and their groups. Have a look at the <a class="reference internal" href="#config-graph">Config Graph</a> for
details.</p>
</dd>
</dl>
</div>
<div class="section" id="btsconfigitem">
<h2>BTSConfigItem</h2>
<p>A <span class="docutils literal">BTSConfigItem</span> is a single node in the configuration tree rooted in a single <a class="reference internal" href="#btsconfiguration">BTSConfiguration</a> object. A
<span class="docutils literal">BTSConfigItem</span> is a <a class="reference internal" href="#btsidentifiableitem">BTSIdentifiableItem</a>, a <a class="reference internal" href="#btsconfig">BTSConfig</a> and a <a class="reference internal" href="#btsobservableobject">BTSObservableObject</a>.  Have a look at the <a class="reference internal" href="#config-graph">Config
Graph</a> to see how this is actually used.</p>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>Note that despite what it might initially seem like, <span class="docutils literal">BTSConfigItem</span> does <em>not</em> inherit from either of
<a class="reference internal" href="#btsnamedtypedobject">BTSNamedTypedObject</a>, <a class="reference internal" href="#btsdbbaseobject">BTSDBBaseObject</a>, <a class="reference internal" href="#administrativdataobject">AdministrativDataObject</a> or <a class="reference internal" href="#btsobject">BTSObject</a>.</p>
</div>
<dl class="field-list simple">
<dt><span class="docutils literal">abbreviation</span></dt>
<dd><p>This field is only used with some objects with <span class="docutils literal">.type == 'objectType'</span> and contains a human-readable abbreviation
of the described type.</p>
</dd>
<dt><span class="docutils literal">description</span></dt>
<dd><p>This rarely used field is meant to contain human-readable comment on this node beyond what fits into <span class="docutils literal">label</span>. For
good measure, its contents are wrapped into an array of <a class="reference internal" href="#btstranslation">BTSTranslation</a> objects.</p>
</dd>
<dt><span class="docutils literal">ignore</span></dt>
<dd><p>This is a boolean field that can be used to &quot;comment out&quot; parts of the configuration. It seems setting this to
<span class="docutils literal">true</span> will also ignore any descendents of this node.</p>
</dd>
<dt><span class="docutils literal">label</span></dt>
<dd><p>This field is apparently meant to contain a human-readable label for the config node. It is similar to <span class="docutils literal">value</span>
<span class="docutils literal">value</span> except that the contents of <span class="docutils literal">label</span> are wrapped into an array of <a class="reference internal" href="#btstranslation">BTSTranslation</a> objects. Because why
not.</p>
</dd>
<dt><span class="docutils literal">ownerReferencedTypesStringList</span></dt>
<dd><p>The purpose of this field is a bit unclear. Its idea seems to be to scope configuration entries to certain object
types.</p>
</dd>
</dl>
<!-- TODO find out wth was the idea with this -->
<dl class="field-list simple">
<dt><span class="docutils literal">passportEditorConfig</span></dt>
<dd><p>This field is only used for config items describing the passport structure and points to a
<a class="reference internal" href="#btspassporteditorconfig">BTSPassportEditorConfig</a> object describing the way the UI should behave for this field.</p>
</dd>
<dt><span class="docutils literal">sortKey</span></dt>
<dd><p>An integer field that in several places is used instead of <span class="docutils literal">name</span> to sort things.</p>
</dd>
<dt><span class="docutils literal">subtype</span></dt>
<dd><p>This is only used when <span class="docutils literal">.type == &quot;objectType&quot;</span> to express some sort of icon to use somewhere. The values are all
like <span class="docutils literal">IMG_SOMETHING_OR_OTHER</span>.</p>
</dd>
<dt><span class="docutils literal">type</span></dt>
<dd><p>This describes the type <em>of the config node itself</em>. One might think that this would be redundant given the
<span class="docutils literal">value</span> attribute and the hierarchical structure of the config, but come on, we're not in the <span class="docutils literal">.ini</span> days
anymore, are we? So, we end up with the following <span class="docutils literal">type</span> values:
* <span class="docutils literal">&lt;none&gt;</span>
* <span class="docutils literal"><span class="pre">Passport-Category</span></span>
* <span class="docutils literal"><span class="pre">Passport-Entry-GroupCategories</span></span>
* <span class="docutils literal"><span class="pre">Passport-Entry-Item</span> Passport</span>
* <span class="docutils literal">Relation</span>
* <span class="docutils literal">objectType</span>
* <span class="docutils literal">objectTypes</span></p>
</dd>
<dt><span class="docutils literal">value</span></dt>
<dd><p>This is the textual value of the config node. For top-level nodes this is generally the same as the Type, for
lower-level nodes this contains e.g. the type names in an enumeration or the passport field names. This field's
value is supposed to be used as an identifier, and thus generally <span class="docutils literal">looks_like_this</span>.</p>
</dd>
<dt><span class="docutils literal">rules</span></dt>
<dd><p>Unused.</p>
</dd>
<dt><span class="docutils literal">showWidget</span></dt>
<dd><p>Unused.</p>
</dd>
</dl>
</div>
<div class="section" id="btsconfiguration">
<h2>BTSConfiguration</h2>
<p>Every project has exactly one <span class="docutils literal">BTSConfiguration</span> stored in its <span class="docutils literal">{project name}_admin</span> database. A
<span class="docutils literal">BTSConfiguration</span> is a <a class="reference internal" href="#btsobject">BTSObject</a> and a <a class="reference internal" href="#btsconfig">BTSConfig</a>. This <span class="docutils literal">BTSConfiguration</span> describes everything and the
kitchen sink, from UI defaults through the ACL to the database schema.  The top-level <span class="docutils literal">BTSConfiguration</span> object is the
root of the config tree. Its descendants are all <a class="reference internal" href="#btsconfigitem">BTSConfigItem</a>. They are stored in the <span class="docutils literal">children</span> attribute
inherited from <a class="reference internal" href="#btsconfig">BTSConfig</a>. Have a look at the <a class="reference internal" href="#config-graph">Config Graph</a> to see how this is actually used.</p>
<dl class="field-list">
<dt><span class="docutils literal">provider</span></dt>
<dd><p>A symbolic name of the config. This is only used to find the configuration object specified in the application
preferences. There is no reason the <span class="docutils literal">_id</span> could not be used there.</p>
<p>Following is a table of all two values this field may take.</p>
<table>
<colgroup>
<col style="width: 45%" />
<col style="width: 17%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr><th class="head"><p><span class="docutils literal">_id</span></p></th>
<th class="head"><p><span class="docutils literal">provider</span></p></th>
<th class="head"><p><span class="docutils literal">name</span></p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal">74cb6b70ab6b58566bfadc664b001f0c</span></p></td>
<td><p><span class="docutils literal">aaew</span></p></td>
<td><p>Altägyptisches Wörterbuch (AAEW)</p></td>
</tr>
<tr><td><p><span class="docutils literal">WTJMUMGNKBGYDMYAYFRNGFNBDQ</span></p></td>
<td><p><span class="docutils literal">aemconfig</span></p></td>
<td><p>AEM Configuration</p></td>
</tr>
</tbody>
</table>
<p>Generated with
<span class="docutils literal">for f in *_admin.json; jq <span class="pre">-C</span> '.docs[] | <span class="pre">select(.eClass</span> == <span class="pre">&quot;http://btsmodel/1.0#//BTSConfiguration&quot;)</span> | .name, .provider' $f; end</span></p>
</dd>
</dl>
</div>
<div class="section" id="btsdbbaseobject">
<h2>BTSDBBaseObject</h2>
<p>BTSDBBaseObject is another of those base types of just about half of everything.</p>
<dl class="field-list simple">
<dt><span class="docutils literal">_rev</span></dt>
<dd><p>Current couchDB MVCC revision of this object. This is a string such as <span class="docutils literal"><span class="pre">1-37221aa74fd85dcb3286a87fadb9cee3</span></span>, with
the digit upfront being an incrementing (but not necessarily unique) counter and the value behind it being a
hex-encoded random value to distinguish concurrent revisions.</p>
</dd>
</dl>
<div class="section" id="access-control-fields">
<h3>Access control fields</h3>
<p>These fields are part of a half-finished implementation of a limited form of <a class="reference external" href="https://en.wikipedia.org/wiki/Access_control_list">ACLs</a>. The idea is that on a per-object
basis, a list of users or groups with read permission and a list of users or groups with update permission may be added.
There does not seem to be any code to propagate permissions from parent to child objects and in the database most
objects do not seem to contain sensible ACLs.</p>
<dl class="field-list simple">
<dt><span class="docutils literal">updaters</span></dt>
<dd><p></p></dd>
<dt><span class="docutils literal">readers</span></dt>
<dd><p>Both of these properties are lists of strings. Each entry is either a user name (which is used as the user
object's couchDB <span class="docutils literal">_id</span>) or a group name. Groups are simply implemented by their constituent users each having their
name as part of a <span class="docutils literal">groupIds</span> array in their own user object. Access is only enforced client-side, if at all.</p>
</dd>
</dl>
</div>
<div class="section" id="fields-for-local-caching-of-values">
<h3>Fields for local caching of values</h3>
<dl class="field-list simple">
<dt><span class="docutils literal">conflictingRevs</span></dt>
<dd><p>This field is a pseudo-attribute that is not written to db. Under certain circumstances it is populated by
<a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/db/dao-couch/src/org/bbaw/bts/dao/couchDB/CouchDBDao.java#L590">CouchDBDao.java</a> with the ids of conflicting revisions of the document containing the field as couchDB sees them.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt><span class="docutils literal">DBCollectionKey</span></dt>
<dd><p>Not written to db. This field is populated in <a class="reference external" href="https://github.com/telota/bts/blob/7f7933ae338cbb22553156658823f42e3464dac5/db/dao-couch/src/org/bbaw/bts/dao/couchDB/CouchDBDao.java">CouchDBDao.java</a> and caches the name of the local elasticsearch
index that contains the object this field belongs to.</p>
</dd>
</dl>
</div>
<div class="section" id="mostly-unused-fields">
<h3>(Mostly) unused fields</h3>
<dl class="field-list simple">
<dt><span class="docutils literal">locked</span></dt>
<dd><p>This field is not written to db. This is a flag that seems to be only used to change the image that is displayed for
a particular obejct.  Has no functional value.</p>
</dd>
<dt><span class="docutils literal">deleted</span></dt>
<dd><p>Not written to db. Flag; does not seem to be used anywhere</p>
</dd>
<dt><span class="docutils literal">project</span></dt>
<dd><p>Not written to db. Seems to be unused.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="btsdbcollectionroledesc">
<h2>BTSDBCollectionRoleDesc</h2>
<p>This type describes a per-corpus &quot;role&quot;. A role seems to be just a set of permissions such as &quot;r&quot; for a &quot;reader&quot; or
&quot;rw&quot; for an updater.</p>
<dl class="field-list simple">
<dt><span class="docutils literal">roleName</span></dt>
<dd><p>This field contains the name of the role, such as <span class="docutils literal">&quot;guests&quot;</span> or <span class="docutils literal">&quot;editors&quot;</span>.</p>
</dd>
<dt><span class="docutils literal">userNames</span></dt>
<dd><p>This field is a list of (human-readable) user names that have this role.</p>
</dd>
<dt><span class="docutils literal">userRoles</span></dt>
<dd><p>Contrary to its name, this field contains a list of couchDB ids of <a class="reference internal" href="#btsusergroup">BTSUserGroup</a> objects. I'm not sure what the
meaning of this is, but I suppose that all members of these groups kinda also get to have this role??</p>
</dd>
</dl>
</div>
<div class="section" id="btsdbconnection">
<h2>BTSDBConnection</h2>
<p>This type describes on a per-corpus basis where to sync to. In practice, all corpora have the same target. There are
three fields to it of which only <span class="docutils literal">masterServer</span> seems to be relevant at all.</p>
<dl class="field-list simple">
<dt><span class="docutils literal">type</span></dt>
<dd><p>This field is either <span class="docutils literal">couchdb</span>, <span class="docutils literal">Couchdb</span> or absent. It does not seem to matter which of those.</p>
</dd>
<dt><span class="docutils literal">masterServer</span></dt>
<dd><p>This field is always the same value, It contains an HTTP URL where the couchDB is to be found.</p>
</dd>
<dt><span class="docutils literal">dbPath</span></dt>
<dd><p>Unused.</p>
</dd>
</dl>
</div>
<div class="section" id="btsdate">
<h2>BTSDate</h2>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>This seems to be unused.</p>
</div>
</div>
<div class="section" id="btsexternalreference">
<h2>BTSExternalReference</h2>
</div>
<div class="section" id="btsidreservationobject">
<h2>BTSIDReservationObject</h2>
</div>
<div class="section" id="btsidentifiableitem">
<h2>BTSIdentifiableItem</h2>
<p>BTSIdentifiableItem is a base interface of most everything in the database. Its purpose is to describe anything that
holds an <span class="docutils literal">_id</span> attribute, which in couchdb is every top-level document (i.e. that is not embedded into some other
document). Its sole field is:</p>
<dl class="field-list">
<dt><span class="docutils literal">_id</span></dt>
<dd><p>The raw couchdb object ID. Do not make any assumptions about the contents of this field. Treat it as couchdb treats
it: As an arbitrary string. Fun fact: There is both an object with the <span class="docutils literal">_id</span> <span class="docutils literal"><span class="pre">-1</span></span> and one with the <span class="docutils literal">_id</span>
<span class="docutils literal"><span class="pre">-2</span></span>.</p>
<p>Using the following code we can get some statistics about these ids.</p>
<pre class="code literal-block"><code>set count (wc -l ids|cut -d' ' -f1); for re in '^&quot;[0-9]+&quot;$' '^&quot;[0-9a-f]{32}&quot;$' '^&quot;[a-zA-Z0-9]{27}&quot;$' '^&quot;[A-Z0-9]{26}&quot;$' '^&quot;dm[0-9]*&quot;$'; set num (egrep $re ids|wc -l); echo $re $num (echo $num/$count|bc -l); end</code></pre>
<p>The total number of objects is slightly over 4.4 million.</p>
<table>
<colgroup>
<col style="width: 53%" />
<col style="width: 19%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr><th class="head"><p>regex</p></th>
<th class="head"><p>count</p></th>
<th class="head"><p>percentage</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal"><span class="pre">[a-zA-Z0-9]{27}</span></span></p></td>
<td><p>4282726</p></td>
<td><p>96.86%</p></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">[A-Z0-9]{26}</span></span></p></td>
<td><p>70761</p></td>
<td><p>1.60%</p></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">[0-9]+</span></span></p></td>
<td><p>52185</p></td>
<td><p>1.18%</p></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">dm[0-9]*</span></span></p></td>
<td><p>7971</p></td>
<td><p>0.18%</p></td>
</tr>
<tr><td><p><span class="docutils literal"><span class="pre">[0-9a-f]{32}</span></span></p></td>
<td><p>3</p></td>
<td><p>0.00%</p></td>
</tr>
<tr><td><p>other</p></td>
<td><p>7932</p></td>
<td><p>0.18%</p></td>
</tr>
</tbody>
</table>
<p>For some database objects inherited from previous BTS versions, short numeric strings such as <span class="docutils literal">100120</span> are used.</p>
</dd>
</dl>
</div>
<div class="section" id="btsintertextreference">
<h2>BTSInterTextReference</h2>
<p><span class="docutils literal">beginId</span> and <span class="docutils literal">endId</span> may be set. If that is the case, the target is a
range of the content of a <span class="docutils literal">BTSText</span> and <span class="docutils literal">beginId</span> and <span class="docutils literal">endId</span> both refer to objects such as <a class="reference internal" href="#btsword">BTSWord</a>.</p>
<p>Following is an exhaustive table of the object types <span class="docutils literal">beginId</span> and <span class="docutils literal">endId</span> refer to in the live data.</p>
<table>
<colgroup>
<col style="width: 53%" />
<col style="width: 19%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr><th class="head"><p>Type</p></th>
<th class="head"><p>Count</p></th>
<th class="head"><p>Frequency</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><a class="reference internal" href="#btsword">BTSWord</a></p></td>
<td><p>44727</p></td>
<td><p>72.2%</p></td>
</tr>
<tr><td><p><a class="reference internal" href="#btsmarker">BTSMarker</a></p></td>
<td><p>17212</p></td>
<td><p>27.8%</p></td>
</tr>
<tr><td><p><a class="reference internal" href="#btsambivalence">BTSAmbivalence</a></p></td>
<td><p>10</p></td>
<td><p>0.0%</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="btsnamedtypedobject">
<h2>BTSNamedTypedObject</h2>
<p>BTSNamedTypedObject is an interface that through <span class="docutils literal">BTSObject</span> and other inheritance paths is implemented by a large
number of types. It describes an object that may have a <span class="docutils literal">name</span>, a <span class="docutils literal">type</span>, a <span class="docutils literal">subtype</span> and a <span class="docutils literal">sortKey</span>. <span class="docutils literal">type</span>
and <span class="docutils literal">subtype</span> are used somewhat inconsistently. For some object types, their range of values is described in the meta
model entries under <span class="docutils literal">/objectTypes</span>. Not every object type uses <span class="docutils literal">type</span> as well as <span class="docutils literal">subtype</span> and not every <span class="docutils literal">type</span>
also has one or more <span class="docutils literal">subtype</span>.</p>
<dl class="field-list">
<dt><span class="docutils literal">name</span></dt>
<dd><p>This field generally describes a human-readable name of the object. The <span class="docutils literal">name</span> is generally used as a label when
displaying objects (e.g. in the tree viewer, or in an input mask). Sample values for this are e.g. <span class="docutils literal">Hammamat <span class="pre">C-M</span> 265</span>
and <span class="docutils literal">〈Wadi Allaqi 3〉</span> for some TCObjects or <span class="docutils literal">ḫnd (ḥr) (mw)</span> and <span class="docutils literal"><span class="pre">mꜣꜣ.t-Ḥr.w</span></span> for some lemmata.</p>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>In case of lemmata the name often is a simple concatenation of transliterations of the lemma's constituent
words, but <strong>this is no rule</strong>.</p>
</div>
</dd>
<dt><span class="docutils literal">type</span></dt>
<dd><p>This field describes the logical type of the object. Its semantics vary by object type/eclass. Following are some
example values found in the live database.</p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr><th class="head"><p>Type</p></th>
<th class="head"><p>List of possible of values in JSON</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal">Corpus:Text</span></p></td>
<td><p><span class="docutils literal">&quot;Text&quot;, &quot;Subtext&quot;, &quot;subtext&quot;, &quot;undefined&quot;, &quot;&quot;, null</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:Senctence</span></p></td>
<td><p><span class="docutils literal">&quot;HS&quot;, null</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">Base:Comment</span></p></td>
<td><p>No type, no subtype.</p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:LemmaEntry</span></p></td>
<td><p><span class="docutils literal">null, &quot;undefined&quot;, &quot;numeral&quot;, &quot;particle&quot;, &quot;preposition&quot;, &quot;verb&quot;, ... ~15</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:Annotation</span></p></td>
<td><p><span class="docutils literal">&quot;undefined&quot;, null, &quot;conceptual&quot; &quot;ConceptualGroup2&quot;, <span class="pre">&quot;Annotation-Leipzig&quot;,</span> ... ~10</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:TCObject</span></p></td>
<td><p><span class="docutils literal">null, &quot;&quot;, &quot;undefined&quot;, &quot;Arrangement&quot;, &quot;TCSuperText&quot;, &quot;TCObject&quot;, &quot;Group&quot;, &quot;Scene&quot;, ... ~10</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:TextCorpus</span></p></td>
<td><p><span class="docutils literal">null, &quot;undefined&quot;</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:ThsEntry</span></p></td>
<td><p><span class="docutils literal">null, &quot;objectType&quot;, &quot;objecttype&quot;, &quot;actor&quot;, &quot;grouping&quot;, &quot;miniature&quot;, &quot;model&quot;, &quot;material&quot;, &quot;copy&quot;, ... ~25</span></p></td>
</tr>
</tbody>
</table>
<p><span class="docutils literal">BTSMarker</span> is a <span class="docutils literal">BTSNamedTypedObject</span>, but its type field seems to be free text provided by the user.</p>
</dd>
<dt><span class="docutils literal">subtype</span></dt>
<dd><p>This field is sometimes used to describe a subtype of an object. It is used only in the following object types:</p>
<table>
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr><th class="head"><p>Type</p></th>
<th class="head"><p>List of possible of values in JSON</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><span class="docutils literal">Base:ConfigItem</span></p></td>
<td><p><span class="docutils literal">&quot;IMG_THS&quot;, &quot;IMG_ANNOTATION&quot;, &quot;IMG_OVR_OBSOLETE&quot;, ... ~30</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:LemmaEntry</span></p></td>
<td><p><span class="docutils literal">&quot;person_name&quot;, &quot;substantive_masc&quot;, &quot;gods_name&quot;, &quot;title&quot;, <span class="pre">&quot;verb_2-lit&quot;,</span> ... ~50</span></p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:Annotation</span></p></td>
<td><p><span class="docutils literal">&quot;MetaphorRelatedWord&quot;, &quot;Metonym&quot;, &quot;subtype&quot;, <span class="pre">&quot;left-to-right&quot;,</span> ... ~10</span>. Only used very infrequently.</p></td>
</tr>
<tr><td><p><span class="docutils literal">Corpus:TCObject</span></p></td>
<td><p>Only four overall usages, with values <span class="docutils literal">&quot;undefined&quot;</span> (thrice) and <span class="docutils literal">&quot;subcaption&quot;</span> (once)</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><span class="docutils literal">sortKey</span></dt>
<dd><p>An integer field that in several places is used instead of <span class="docutils literal">name</span> to sort things. Following is an exhaustive table
of occurences.</p>
<table>
<colgroup>
<col style="width: 54%" />
<col style="width: 20%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr><th class="head"><p>Type</p></th>
<th class="head"><p>Count</p></th>
<th class="head"><p>Frequency</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>Corpus:Text</p></td>
<td><p>14196</p></td>
<td><p>46.38%</p></td>
</tr>
<tr><td><p>Corpus:TCObject</p></td>
<td><p>1403</p></td>
<td><p>8.76%</p></td>
</tr>
<tr><td><p>Corpus:ThsEntry</p></td>
<td><p>4</p></td>
<td><p>0.115%</p></td>
</tr>
<tr><td><p>Corpus:Annotation</p></td>
<td><p>2</p></td>
<td><p>0.014%</p></td>
</tr>
<tr><td><p>Corpus:TextCorpus</p></td>
<td><p>1</p></td>
<td><p>2.00%</p></td>
</tr>
<tr><td><p>Base:ConfigItem</p></td>
<td><p>297</p></td>
<td><p>36.89%</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<div class="section" id="btsobject">
<h2>BTSObject</h2>
<p>Base type for a large part of database objects. Brings in <span class="docutils literal">_id, name, type, subtype, sortKey</span> by means of inheritance
from <span class="docutils literal">BTSNamedTypedObject</span> and in turn <span class="docutils literal">BTSIdentifiableItem</span>. Also brings in <span class="docutils literal">revisions, state, revisionState, visibility</span> from AdministrativDataObject.</p>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>Despite its name only about half of the database object types inherit from this. Also, do not trust even the meager
amounts of documentation in its source code.</p>
</div>
<p>The model for BTSObject includes a field <span class="docutils literal">tempSortKey</span> that is used in some places, but this field never makes it to
the database. It is instead used as some kind of object-global variable.</p>
<dl class="field-list">
<dt><span class="docutils literal">code</span></dt>
<dd><p>Never used.</p>
</dd>
<dt><span class="docutils literal">relations</span></dt>
<dd><p>Array field of <span class="docutils literal">Relation</span> objects describing relations between the containing object and other objects. This is
used to describe complex relations such as <span class="docutils literal">rootOf</span> or <span class="docutils literal">composedOf</span> for lemmata. <em>Everywhere</em> else it is only
ever used with <span class="docutils literal">partOf</span> to express the hierarchical structure of the object tree. Below is an exhaustive table of
occurences.</p>
<table>
<colgroup>
<col style="width: 54%" />
<col style="width: 20%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr><th class="head"><p>Type</p></th>
<th class="head"><p>Count</p></th>
<th class="head"><p>Frequency</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>Corpus:Annotation</p></td>
<td><p>13862</p></td>
<td><p>100%</p></td>
</tr>
<tr><td><p>Corpus:TCObject</p></td>
<td><p>16008</p></td>
<td><p>100%</p></td>
</tr>
<tr><td><p>Corpus:Text</p></td>
<td><p>30605</p></td>
<td><p>99.99%</p></td>
</tr>
<tr><td><p>Base:Comment</p></td>
<td><p>33312</p></td>
<td><p>99.99%</p></td>
</tr>
<tr><td><p>Corpus:ThsEntry</p></td>
<td><p>3457</p></td>
<td><p>99.34%</p></td>
</tr>
<tr><td><p>Corpus:LemmaEntry</p></td>
<td><p>20195</p></td>
<td><p>30.11%!</p></td>
</tr>
<tr><td><p>Corpus:TextCorpus</p></td>
<td><p>1</p></td>
<td><p>2%</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><span class="docutils literal">externalReferences</span></dt>
<dd><p>This field is an array of <span class="docutils literal">ExternalReference</span> objects. The idea here seems to be to store alternative ways to
refer to the entry containing the field. In practice, it only used a handful (&lt;50) times outside the dictionary
proper with the notable exception of the TLA demotic corpus. In the TLA demotic corpus it is used to store malformed
URLs pointing to an external database. In the dictionary it is used to store reference numbers of the entries. In
the user database it is used to store what seems to be user IDs of a previous BTS version.</p>
<p>Below is a listing of occurrences by object type in the database.</p>
<table>
<colgroup>
<col style="width: 54%" />
<col style="width: 20%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr><th class="head"><p>Type</p></th>
<th class="head"><p>Count</p></th>
<th class="head"><p>Frequency</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>Corpus:LemmaEntry</p></td>
<td><p>63391</p></td>
<td><p>94.52%</p></td>
</tr>
<tr><td><p>Corpus:ThsEntry</p></td>
<td><p>3459</p></td>
<td><p>99.40%</p></td>
</tr>
<tr><td><p>Base:User</p></td>
<td><p>55</p></td>
<td><p>47%</p></td>
</tr>
<tr><td><p>Corpus:TCObject</p></td>
<td><p>1370</p></td>
<td><p>8.56%</p></td>
</tr>
<tr><td><p>Corpus:Text</p></td>
<td><p>109</p></td>
<td><p>0.36%</p></td>
</tr>
<tr><td><p>Base:UserGroup</p></td>
<td><p>11</p></td>
<td><p>0.45%</p></td>
</tr>
<tr><td><p>Corpus:Annotation</p></td>
<td><p>3</p></td>
<td><p>0.00%</p></td>
</tr>
<tr><td><p>Corpus:TextCorpus</p></td>
<td><p>1</p></td>
<td><p>2%</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<div class="section" id="btsobservableobject">
<h2>BTSObservableObject</h2>
<p>BTSObservableObject is purely internal. It extends EObject and adds an interface for third parties to track
modifications of this object's eclipsey properties.</p>
</div>
<div class="section" id="btsoperator">
<h2>BTSOperator</h2>
</div>
<div class="section" id="btspassporteditorconfig">
<h2>BTSPassportEditorConfig</h2>
</div>
<div class="section" id="btsproject">
<h2>BTSProject</h2>
</div>
<div class="section" id="btsprojectdbcollection">
<h2>BTSProjectDBCollection</h2>
</div>
<div class="section" id="btsreferencableitem">
<h2>BTSReferencableItem</h2>
</div>
<div class="section" id="btsrelation">
<h2>BTSRelation</h2>
<p>Since CouchDB is a document oriented database what more natural way is there to describe the tree-like hierarchy of
objects than by kludging an ersatz relational layer on it?</p>
<p>A <span class="docutils literal">BTSRelation</span> represents a single item in a relation (and not as the name implies the relation itself). An
implementation detail is that these relations are inherently directional, and the <span class="docutils literal">BTSRelation</span> object is always
stored in the <em>head</em> object. So, a <span class="docutils literal">partOf</span> relation describing that object <span class="docutils literal">A</span> is a part of object <span class="docutils literal">B</span> would be
stored in object <span class="docutils literal">A</span>. Read: <span class="docutils literal">A is partOf B</span>.</p>
<p>Every relation contains the couchDB <span class="docutils literal">_id</span> of its target object in its <span class="docutils literal">objectId</span> field.</p>
<p>Relations come in many flavors. The important one is <span class="docutils literal">partOf</span>, which is used to express hierarchical structure in the
object browser. It can be used on most anything. The other relation type flavors are only used on <span class="docutils literal">BTSLemmaEntry</span>
objects. Below is a nice list of what is related to what and how and how often.</p>
<p>Due to the inherently asymmetric nature of this representation, most &quot;relation types&quot; need a reciprocal type to be put
at the far end of the relation. Such pairs are e.g. <span class="docutils literal">successor</span> and <span class="docutils literal">predecessor</span> or <span class="docutils literal">composes</span> and
<span class="docutils literal">composedOf</span>. Note that these are sometimes not named very well.</p>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p><span class="docutils literal">partOf</span> relations do not have a reciprocal element.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>reciprocal relations are maintained by hand, this does in practice lead to inconsistencies as are evident
for example from the untyped relations shown in the data below.</p>
</div>
<pre>Type <font color="#cc3333">CorpusModel:Annotation</font>
       13830 <font color="#cc6633">partOf</font>(<font color="#3333cc">CorpusModel:Text</font>)
          15 <font color="#cc6633">partOf</font>(<font color="#3333cc">None</font>)
           8 <font color="#cc6633">partOf</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
           5 <font color="#cc6633">partOf</font>(<font color="#cc3366">CorpusModel:TextCorpus</font>)
           4 <font color="#cc6633">partOf</font>(<font color="#33cc99">CorpusModel:TCObject</font>)
           1 <font color="#cc6633">partOf</font>(<font color="#6633cc">&lt;parts&gt;</font>)
           1 <font color="#cc6633">partOf</font>(<font color="#cc3366">CorpusModel:ThsEntry</font>)

Type <font color="#3399cc">CorpusModel:LemmaEntry</font>
       10808 <font color="#3333cc">rootOf</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
        7028 <font color="#6633cc">referencing</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
        6992 <font color="#33cccc">referencedBy</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
        3768 <font color="#6633cc">successor</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
        3765 <font color="#cc33cc">predecessor</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
        3278 <font color="#33cc33">composedOf</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
        3278 <font color="#cc3333">composes</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
        1810 <font color="#cc6633">partOf</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
        1729 <font color="#cc3399">contains</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
         109 <font color="#6633cc">successor</font>(<font color="#3333cc">None</font>)
           6 <font color="#33cccc">referencedBy</font>(<font color="#3333cc">None</font>)
           4 <font color="#3399cc">&lt;none&gt;</font>(<font color="#6633cc">&lt;parts&gt;</font>)
           2 <font color="#cc6633">partOf</font>(<font color="#6633cc">&lt;parts&gt;</font>)
           1 <font color="#33cccc">referencedBy</font>(<font color="#6633cc">&lt;parts&gt;</font>)
           1 <font color="#3333cc">rootOf</font>(<font color="#6633cc">&lt;parts&gt;</font>)

 Type <font color="#33cc99">CorpusModel:TCObject</font>
       15843 <font color="#cc6633">partOf</font>(<font color="#33cc99">CorpusModel:TCObject</font>)
         169 <font color="#cc6633">partOf</font>(<font color="#cc3366">CorpusModel:TextCorpus</font>)
          16 <font color="#cc6633">partOf</font>(<font color="#3333cc">CorpusModel:Text</font>)
           1 <font color="#3399cc">&lt;none&gt;</font>(<font color="#6633cc">&lt;parts&gt;</font>)
           1 <font color="#cc6633">partOf</font>(<font color="#6633cc">&lt;parts&gt;</font>)

 Type <font color="#3333cc">CorpusModel:Text</font>
       26586 <font color="#cc6633">partOf</font>(<font color="#33cc99">CorpusModel:TCObject</font>)
        4007 <font color="#cc6633">partOf</font>(<font color="#3333cc">CorpusModel:Text</font>)
          46 <font color="#cc6633">partOf</font>(<font color="#cc3366">CorpusModel:TextCorpus</font>)
           2 <font color="#3399cc">&lt;none&gt;</font>(<font color="#6633cc">&lt;parts&gt;</font>)
           2 <font color="#cc6633">partOf</font>(<font color="#6633cc">&lt;parts&gt;</font>)

 Type <font color="#cc3366">CorpusModel:TextCorpus</font>
           1 <font color="#3399cc">&lt;none&gt;</font>(<font color="#6633cc">&lt;parts&gt;</font>)

 Type <font color="#cc3366">CorpusModel:ThsEntry</font>
        3441 <font color="#cc6633">partOf</font>(<font color="#cc3366">CorpusModel:ThsEntry</font>)
          11 <font color="#cc6633">partOf</font>(<font color="#3333cc">None</font>)
           5 <font color="#33cc33">owner</font>(<font color="#3333cc">None</font>)

 Type <font color="#cc3333">model:Comment</font>
       33295 <font color="#cc6633">partOf</font>(<font color="#3333cc">CorpusModel:Text</font>)
           8 <font color="#cc6633">partOf</font>(<font color="#3333cc">None</font>)
           6 <font color="#cc6633">partOf</font>(<font color="#33cc99">CorpusModel:TCObject</font>)
           3 <font color="#cc6633">partOf</font>(<font color="#3399cc">CorpusModel:LemmaEntry</font>)
           1 <font color="#cc6633">partOf</font>(<font color="#cc3366">CorpusModel:TextCorpus</font>)
           1 <font color="#cc6633">partOf</font>(<font color="#cc3366">CorpusModel:ThsEntry</font>)</pre><div class="section" id="partof-relations">
<h3>PartOf relations</h3>
<p>In certain cases such as when used with a <a class="reference internal" href="#btscomment">BTSComment</a> a <span class="docutils literal">partOf</span> relation may contain <span class="docutils literal">parts</span>. Each &quot;part&quot; is a
<a class="reference internal" href="#btsintertextreference">BTSInterTextReference</a> pointing to part of some text. The statistics of the number of parts as extracted from a
database backup are as follows.</p>
<p><span class="docutils literal">jq <span class="pre">'.docs[].relations[]?.parts</span> | length' *.json | sort | uniq <span class="pre">-c</span> | sort <span class="pre">-bnk2</span></span></p>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 29%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr><th class="head"><p>length</p></th>
<th class="head"><p>count</p></th>
<th class="head"><p>percentage</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>0</p></td>
<td><p>92685</p></td>
<td><p>66.26</p></td>
</tr>
<tr><td><p>1</p></td>
<td><p>46892</p></td>
<td><p>33.52</p></td>
</tr>
<tr><td><p>2</p></td>
<td><p>206</p></td>
<td><p>0.15</p></td>
</tr>
<tr><td><p>3</p></td>
<td><p>53</p></td>
<td><p>0.04</p></td>
</tr>
<tr><td><p>4</p></td>
<td><p>28</p></td>
<td><p>0.02</p></td>
</tr>
<tr><td><p>5</p></td>
<td><p>11</p></td>
<td><p>0.01</p></td>
</tr>
<tr><td><p>6</p></td>
<td><p>6</p></td>
<td><p>0.00</p></td>
</tr>
<tr><td><p>7</p></td>
<td><p>2</p></td>
<td><p>0.00</p></td>
</tr>
<tr><td><p>8</p></td>
<td><p>1</p></td>
<td><p>0.00</p></td>
</tr>
<tr><td><p>9</p></td>
<td><p>1</p></td>
<td><p>0.00</p></td>
</tr>
<tr><td><p>12</p></td>
<td><p>1</p></td>
<td><p>0.00</p></td>
</tr>
<tr><td><p>13</p></td>
<td><p>1</p></td>
<td><p>0.00</p></td>
</tr>
<tr><td><p>16</p></td>
<td><p>1</p></td>
<td><p>0.00</p></td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>Technically, the <span class="docutils literal">partOf</span> graph is only directed. In practice, it seems it is also acyclic and something would
probably crash if it wasn't. It is, however, <em>not</em> a vanilla tree as objects can have several parents.</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>TODO: Right now I can't make any statements on the equivalency of two <span class="docutils literal">partOf</span> relations using the same target
<span class="docutils literal">objectId</span> but each containing different <span class="docutils literal">parts</span> and only one <span class="docutils literal">partOf</span> relation using the same target
<span class="docutils literal">objectId</span> but containing the union of both partses .</p>
</div>
</div>
</div>
<div class="section" id="btsrevision">
<h2>BTSRevision</h2>
</div>
<div class="section" id="btstimespan">
<h2>BTSTimespan</h2>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>This seems to be unused.</p>
</div>
</div>
<div class="section" id="btstranslation">
<h2>BTSTranslation</h2>
</div>
<div class="section" id="btstranslations">
<h2>BTSTranslations</h2>
</div>
<div class="section" id="btsuser">
<h2>BTSUser</h2>
</div>
<div class="section" id="btsusergroup">
<h2>BTSUserGroup</h2>
</div>
<div class="section" id="btsworkflowrule">
<h2>BTSWorkflowRule</h2>
</div>
<div class="section" id="btsworkflowruleitem">
<h2>BTSWorkflowRuleItem</h2>
</div>
<div class="section" id="dblease">
<h2>DBLease</h2>
</div>
<div class="section" id="useractioncounter">
<h2>UserActionCounter</h2>
</div>
<div class="section" id="stringtostringlistmap">
<h2>StringToStringListMap</h2>
</div>
<div class="section" id="stringtostringmap">
<h2>StringToStringMap</h2>
</div>
</div>
<div class="section" id="objekttypen-des-corpus-modells">
<h1>Objekttypen des Corpus-Modells</h1>
<div class="section" id="btsabstractparagraph">
<h2>BTSAbstractParagraph</h2>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>This seems to be unused.</p>
</div>
</div>
<div class="section" id="btsabstracttext">
<h2>BTSAbstractText</h2>
</div>
<div class="section" id="btsambivalence">
<h2>BTSAmbivalence</h2>
</div>
<div class="section" id="btsambivalenceitem">
<h2>BTSAmbivalenceItem</h2>
</div>
<div class="section" id="btsannotation">
<h2>BTSAnnotation</h2>
</div>
<div class="section" id="btscorpusheader">
<h2>BTSCorpusHeader</h2>
</div>
<div class="section" id="btscorpusobject">
<h2>BTSCorpusObject</h2>
<p>This is the base class for objects that can be shown in one of the tree viewers. This is a subtype of BTSObject, and as
such also includes everything of BTSNamedTypedObject, AdministrativDataObject and BTSIdentifiableItem:</p>
<pre class="code literal-block"><code>_id, name, type, subtype, sortKey, code, relations, externalReferences, revisions, state, revisionState, visibility</code></pre>
<div class="admonition attention">
<p class="admonition-title">Attention!</p>
<p>Do not confuse this with the similarly named <span class="docutils literal">BTSTCObject</span> (from &quot;Text Corpus Object&quot;) or <span class="docutils literal">BTSTextCorpus</span>. Both
are subclasses of <span class="docutils literal">BTSCorpusObject</span>. The later is an individual corpus such as the <span class="docutils literal">bbawfelsinschriften</span> while
the former is something like an annotated folder that is part of a corpus or another folder.</p>
</div>
<dl class="field-list simple">
<dt><span class="docutils literal">passport</span></dt>
<dd><p>The BTSPassport of the object. This contains a more-or-less arbitrary, loosely schematized collection of keys and
values describing this object.</p>
</dd>
<dt><span class="docutils literal">corpusPrefix</span></dt>
<dd><p>This field contains the name of the corpus this object is stored in, which corresponds to the couchDB database name.
For example, <span class="docutils literal">bbawfelsinschriften</span> for <span class="docutils literal">aaew_corpus_bbawfelsinschriften</span>. Obviously, maintaining a local copy of
the database name inside every single object is of the highest priority for purposes of data security.</p>
</dd>
<dt><span class="docutils literal">workPhase</span></dt>
<dd><p>Never used.</p>
</dd>
</dl>
</div>
<div class="section" id="btsgraphic">
<h2>BTSGraphic</h2>
</div>
<div class="section" id="btsimage">
<h2>BTSImage</h2>
</div>
<div class="section" id="btslemmacase">
<h2>BTSLemmaCase</h2>
</div>
<div class="section" id="btslemmaentry">
<h2>BTSLemmaEntry</h2>
</div>
<div class="section" id="btsmarker">
<h2>BTSMarker</h2>
</div>
<div class="section" id="btspassport">
<h2>BTSPassport</h2>
</div>
<div class="section" id="btspassportentry">
<h2>BTSPassportEntry</h2>
</div>
<div class="section" id="btspassportentrygroup">
<h2>BTSPassportEntryGroup</h2>
</div>
<div class="section" id="btspassportentryitem">
<h2>BTSPassportEntryItem</h2>
</div>
<div class="section" id="btssenctence">
<h2>BTSSenctence</h2>
</div>
<div class="section" id="btssentenceitem">
<h2>BTSSentenceItem</h2>
</div>
<div class="section" id="btstcobject">
<h2>BTSTCObject</h2>
</div>
<div class="section" id="btstext">
<h2>BTSText</h2>
</div>
<div class="section" id="btstextcontent">
<h2>BTSTextContent</h2>
</div>
<div class="section" id="btstextcorpus">
<h2>BTSTextCorpus</h2>
</div>
<div class="section" id="btstextitems">
<h2>BTSTextItems</h2>
</div>
<div class="section" id="btstextsentenceitem">
<h2>BTSTextSentenceItem</h2>
</div>
<div class="section" id="btsthsentry">
<h2>BTSThsEntry</h2>
</div>
<div class="section" id="btsword">
<h2>BTSWord</h2>
</div>
</div>
<div class="section" id="config-graph">
<h1>Config Graph</h1>
<div class="figure">
<a class="reference external image-reference" href="graphs/config_graph_hybrid.pdf"><img alt="graphs/config_graph_hybrid.png" src="graphs/config_graph_hybrid.png" style="width: 100%;" /></a>
<p class="caption">Graph of the unified hierarchical structure of both <a class="reference internal" href="#btsconfiguration">BTSConfiguration</a> instances. Each <a class="reference internal" href="#btsconfigitem">BTSConfigItem</a> is
annotated with its <span class="docutils literal">type</span> attribute.</p>
</div>
</div>
</div>
</body>
</html>
